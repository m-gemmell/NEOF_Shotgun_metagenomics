<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Functional profiling | Shotgun Metagenomics</title>
  <meta name="description" content="Chapter 9 Functional profiling | Shotgun Metagenomics" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Functional profiling | Shotgun Metagenomics" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Functional profiling | Shotgun Metagenomics" />
  
  
  

<meta name="author" content="Sam Haldenby and Matthew R. Gemmell" />


<meta name="date" content="2021-05-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="08-Taxonomic_profiling.html"/>
<link rel="next" href="10-Metagenome_assembly.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a>Shotgun Metagenomics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="01-Shotgun_metagenomics.html"><a href="01-Shotgun_metagenomics.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="02-Overview.html"><a href="02-Overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Overview.html"><a href="02-Overview.html#what-is-metagenomics"><i class="fa fa-check"></i><b>2.1</b> What is metagenomics?</a></li>
<li class="chapter" data-level="2.2" data-path="02-Overview.html"><a href="02-Overview.html#why-metagenomics"><i class="fa fa-check"></i><b>2.2</b> Why metagenomics?</a></li>
<li class="chapter" data-level="2.3" data-path="02-Overview.html"><a href="02-Overview.html#metagenomics-vs-metagenetics"><i class="fa fa-check"></i><b>2.3</b> Metagenomics vs Metagenetics</a></li>
<li class="chapter" data-level="2.4" data-path="02-Overview.html"><a href="02-Overview.html#tutorial-overview"><i class="fa fa-check"></i><b>2.4</b> Tutorial overview</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="02-Overview.html"><a href="02-Overview.html#basics"><i class="fa fa-check"></i><b>2.4.1</b> Basics</a></li>
<li class="chapter" data-level="2.4.2" data-path="02-Overview.html"><a href="02-Overview.html#structure"><i class="fa fa-check"></i><b>2.4.2</b> Structure</a></li>
<li class="chapter" data-level="2.4.3" data-path="02-Overview.html"><a href="02-Overview.html#content"><i class="fa fa-check"></i><b>2.4.3</b> Content</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-Start.html"><a href="03-Start.html"><i class="fa fa-check"></i><b>3</b> Before we start</a></li>
<li class="chapter" data-level="4" data-path="04-Cluster_Introduction.html"><a href="04-Cluster_Introduction.html"><i class="fa fa-check"></i><b>4</b> Cluster Introduction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-Cluster_Introduction.html"><a href="04-Cluster_Introduction.html#logon-instructions"><i class="fa fa-check"></i><b>4.1</b> Logon instructions</a></li>
<li class="chapter" data-level="4.2" data-path="04-Cluster_Introduction.html"><a href="04-Cluster_Introduction.html#the-terminal-window"><i class="fa fa-check"></i><b>4.2</b> The Terminal Window</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05-Raw_data.html"><a href="05-Raw_data.html"><i class="fa fa-check"></i><b>5</b> Raw data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-Raw_data.html"><a href="05-Raw_data.html#obtaining-the-data"><i class="fa fa-check"></i><b>5.1</b> Obtaining the data</a></li>
<li class="chapter" data-level="5.2" data-path="05-Raw_data.html"><a href="05-Raw_data.html#checking-quality-control"><i class="fa fa-check"></i><b>5.2</b> Checking quality control</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html"><i class="fa fa-check"></i><b>6</b> Quality control</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html#removing-adapters-and-low-quality-bases"><i class="fa fa-check"></i><b>6.1</b> Removing adapters and low quality bases</a></li>
<li class="chapter" data-level="6.2" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html#rename-the-files"><i class="fa fa-check"></i><b>6.2</b> Rename the files</a></li>
<li class="chapter" data-level="6.3" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html#inspect-the-trimmed-data"><i class="fa fa-check"></i><b>6.3</b> Inspect the trimmed data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-Host_removal.html"><a href="07-Host_removal.html"><i class="fa fa-check"></i><b>7</b> Host removal</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07-Host_removal.html"><a href="07-Host_removal.html#index-reference"><i class="fa fa-check"></i><b>7.1</b> Index reference</a></li>
<li class="chapter" data-level="7.2" data-path="07-Host_removal.html"><a href="07-Host_removal.html#alignment"><i class="fa fa-check"></i><b>7.2</b> Alignment</a></li>
<li class="chapter" data-level="7.3" data-path="07-Host_removal.html"><a href="07-Host_removal.html#unmapped-read-extraction"><i class="fa fa-check"></i><b>7.3</b> Unmapped read extraction</a></li>
<li class="chapter" data-level="7.4" data-path="07-Host_removal.html"><a href="07-Host_removal.html#re-pair"><i class="fa fa-check"></i><b>7.4</b> Re-pair</a></li>
<li class="chapter" data-level="7.5" data-path="07-Host_removal.html"><a href="07-Host_removal.html#host-removal-considerations"><i class="fa fa-check"></i><b>7.5</b> Host removal considerations</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html"><i class="fa fa-check"></i><b>8</b> Taxonomic profiling</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2"><i class="fa fa-check"></i><b>8.1</b> Kraken2</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2-run"><i class="fa fa-check"></i><b>8.1.1</b> Kraken2: run</a></li>
<li class="chapter" data-level="8.1.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2-output"><i class="fa fa-check"></i><b>8.1.2</b> Kraken2: output</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#krona-plot"><i class="fa fa-check"></i><b>8.2</b> Krona plot</a></li>
<li class="chapter" data-level="8.3" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken"><i class="fa fa-check"></i><b>8.3</b> Bracken</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-run"><i class="fa fa-check"></i><b>8.3.1</b> Bracken: run</a></li>
<li class="chapter" data-level="8.3.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-output"><i class="fa fa-check"></i><b>8.3.2</b> Bracken: output</a></li>
<li class="chapter" data-level="8.3.3" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-merging-and-extracting-output"><i class="fa fa-check"></i><b>8.3.3</b> Bracken: merging and extracting output</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-biomarker-detection"><i class="fa fa-check"></i><b>8.4</b> LEfSe biomarker detection</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-add-metadata"><i class="fa fa-check"></i><b>8.4.1</b> LEfSe: add metadata</a></li>
<li class="chapter" data-level="8.4.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-conda"><i class="fa fa-check"></i><b>8.4.2</b> LEfSe: conda</a></li>
<li class="chapter" data-level="8.4.3" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-format"><i class="fa fa-check"></i><b>8.4.3</b> LEfSe: format</a></li>
<li class="chapter" data-level="8.4.4" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-run"><i class="fa fa-check"></i><b>8.4.4</b> LEfSe: run</a></li>
<li class="chapter" data-level="8.4.5" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-visualisation"><i class="fa fa-check"></i><b>8.4.5</b> LEfSe: visualisation</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2-and-bracken-databases"><i class="fa fa-check"></i><b>8.5</b> Kraken2 and Bracken databases</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html"><i class="fa fa-check"></i><b>9</b> Functional profiling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann2"><i class="fa fa-check"></i><b>9.1</b> HUMAnN2</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann2-conda-directories-and-files"><i class="fa fa-check"></i><b>9.1.1</b> HUMAnN2: conda, directories, and files</a></li>
<li class="chapter" data-level="9.1.2" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann2-run"><i class="fa fa-check"></i><b>9.1.2</b> HUMAnN2: run</a></li>
<li class="chapter" data-level="9.1.3" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann2-output"><i class="fa fa-check"></i><b>9.1.3</b> HUMAnN2: output</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#statistical-comparison-between-samples"><i class="fa fa-check"></i><b>9.2</b> Statistical comparison between samples</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#combining-data"><i class="fa fa-check"></i><b>9.2.1</b> Combining data</a></li>
<li class="chapter" data-level="9.2.2" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#renormalising-data"><i class="fa fa-check"></i><b>9.2.2</b> Renormalising data</a></li>
<li class="chapter" data-level="9.2.3" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#visualisation"><i class="fa fa-check"></i><b>9.2.3</b> Visualisation</a></li>
<li class="chapter" data-level="9.2.4" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#finding-statistically-significant-differences"><i class="fa fa-check"></i><b>9.2.4</b> Finding statistically significant differences</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html"><i class="fa fa-check"></i><b>10</b> Metagenome assembly</a>
<ul>
<li class="chapter" data-level="10.1" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#a-primer-on-short-read-assembly"><i class="fa fa-check"></i><b>10.1</b> A primer on short read assembly</a></li>
<li class="chapter" data-level="10.2" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#stitching-read-pairs"><i class="fa fa-check"></i><b>10.2</b> Stitching read pairs</a></li>
<li class="chapter" data-level="10.3" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#assembly"><i class="fa fa-check"></i><b>10.3</b> Assembly</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#quast"><i class="fa fa-check"></i><b>10.3.1</b> QUAST</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html"><i class="fa fa-check"></i><b>11</b> Genome binning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#genomic-binning-and-mags"><i class="fa fa-check"></i><b>11.1</b> Genomic binning and MAGs</a></li>
<li class="chapter" data-level="11.2" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#conda-environment-directory"><i class="fa fa-check"></i><b>11.2</b> Conda environment &amp; directory</a></li>
<li class="chapter" data-level="11.3" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#depth-calculation"><i class="fa fa-check"></i><b>11.3</b> Depth calculation</a></li>
<li class="chapter" data-level="11.4" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#metabat2"><i class="fa fa-check"></i><b>11.4</b> MetaBAT2</a></li>
<li class="chapter" data-level="11.5" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#checkm"><i class="fa fa-check"></i><b>11.5</b> CheckM</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#conda"><i class="fa fa-check"></i><b>11.5.1</b> Conda</a></li>
<li class="chapter" data-level="11.5.2" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#running-checkm"><i class="fa fa-check"></i><b>11.5.2</b> Running CheckM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-Gene_prediction.html"><a href="12-Gene_prediction.html"><i class="fa fa-check"></i><b>12</b> Gene Prediciton</a>
<ul>
<li class="chapter" data-level="12.1" data-path="12-Gene_prediction.html"><a href="12-Gene_prediction.html#running-the-software"><i class="fa fa-check"></i><b>12.1</b> Running the software</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-Functional_annotation.html"><a href="13-Functional_annotation.html"><i class="fa fa-check"></i><b>13</b> Functional annotation</a>
<ul>
<li class="chapter" data-level="13.1" data-path="13-Functional_annotation.html"><a href="13-Functional_annotation.html#annotation-types"><i class="fa fa-check"></i><b>13.1</b> Annotation types</a></li>
<li class="chapter" data-level="13.2" data-path="13-Functional_annotation.html"><a href="13-Functional_annotation.html#running-cognizer"><i class="fa fa-check"></i><b>13.2</b> Running Cognizer</a></li>
<li class="chapter" data-level="13.3" data-path="13-Functional_annotation.html"><a href="13-Functional_annotation.html#visualisation-1"><i class="fa fa-check"></i><b>13.3</b> Visualisation</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="13-Functional_annotation.html"><a href="13-Functional_annotation.html#cog-categories"><i class="fa fa-check"></i><b>13.3.1</b> COG categories</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="14-Co_assembly.html"><a href="14-Co_assembly.html"><i class="fa fa-check"></i><b>14</b> Co-assembly and coverage</a>
<ul>
<li class="chapter" data-level="14.1" data-path="14-Co_assembly.html"><a href="14-Co_assembly.html#running-the-co-assembly-gene-predictions-and-annotations"><i class="fa fa-check"></i><b>14.1</b> Running the co-assembly, gene predictions and annotations</a></li>
<li class="chapter" data-level="14.2" data-path="14-Co_assembly.html"><a href="14-Co_assembly.html#generation-of-coverage-metrics"><i class="fa fa-check"></i><b>14.2</b> Generation of coverage metrics</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="15-Comparative_analysis.html"><a href="15-Comparative_analysis.html"><i class="fa fa-check"></i><b>15</b> Comparative analysis</a>
<ul>
<li class="chapter" data-level="15.1" data-path="15-Comparative_analysis.html"><a href="15-Comparative_analysis.html#cog-categories-1"><i class="fa fa-check"></i><b>15.1</b> COG categories</a></li>
<li class="chapter" data-level="15.2" data-path="15-Comparative_analysis.html"><a href="15-Comparative_analysis.html#kegg-pathways-1"><i class="fa fa-check"></i><b>15.2</b> KEGG pathways</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="16-Appendix.html"><a href="16-Appendix.html"><i class="fa fa-check"></i><b>16</b> Appendix</a>
<ul>
<li class="chapter" data-level="16.1" data-path="16-Appendix.html"><a href="16-Appendix.html#manuals"><i class="fa fa-check"></i><b>16.1</b> Manuals</a></li>
<li class="chapter" data-level="16.2" data-path="16-Appendix.html"><a href="16-Appendix.html#cog-cateories"><i class="fa fa-check"></i><b>16.2</b> COG Cateories</a></li>
<li class="chapter" data-level="16.3" data-path="16-Appendix.html"><a href="16-Appendix.html#obtaining-read-data"><i class="fa fa-check"></i><b>16.3</b> Obtaining Read Data</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Shotgun Metagenomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functional-profiling" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Functional profiling</h1>
<p><img src="figures/profile.png" width="15%" style="display: block; margin: auto;" /></p>
<p>It is also possible to investigate functional differences between metagenome (and metatranscriptome) samples by directly interrogating the read data. We will now look at how this can be done with a package called <code>HUMAnN2</code> (The HMP Unified Metabolic Analysis Network 2), a pipeline designed to accurately profile the presence/absence and abundance of microbial pathways in metagenomic sequencing data.</p>
<div id="humann2" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> HUMAnN2</h2>
<p><img src="figures/humann2.png" width="15%" style="display: block; margin: auto;" /></p>
<p>First, we will carry out an example run of the software and briefly explore the output files. HUMAnN2 can take a long time to run so we will use a small amount of example data.</p>
<div id="humann2-conda-directories-and-files" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> HUMAnN2: conda, directories, and files</h3>
<p>We need a new conda environment again. Open a new terminal (right click on the main screen background, choose <code>Applications</code> -&gt; <code>Shell</code> -&gt; <code>bash</code>) and run the below:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="09-Functional_profiling.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> <span class="ex">usehumann2</span></span></code></pre></div>
<p>Make a new directory and move into it.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="09-Functional_profiling.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/4-FunctionalProfiling</span>
<span id="cb37-2"><a href="09-Functional_profiling.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/4-FunctionalProfiling</span></code></pre></div>
<p>Copy over some test data we will the analysis on. This is a demonstration FASTQ file that we will use. It will be small enough to run HUMAnN2 in a reasonable time.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb38-1"><a href="09-Functional_profiling.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /pub39/tea/matthew/NEOF/Shotgun_metagenomics/humann2/demo.fq.gz .</span></code></pre></div>
</div>
<div id="humann2-run" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> HUMAnN2: run</h3>
<p>Now we will perform the run with HUMAnN2 so we can inspect the output files.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb39-1"><a href="09-Functional_profiling.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="ex">humann2</span> <span class="kw">\</span></span>
<span id="cb39-2"><a href="09-Functional_profiling.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="ex">--input</span> demo.fq.gz <span class="kw">\</span></span>
<span id="cb39-3"><a href="09-Functional_profiling.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="ex">--output</span> demo.humann2 <span class="dt">\ </span></span>
<span id="cb39-4"><a href="09-Functional_profiling.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="ex">--threads</span> 10</span></code></pre></div>
<p>Here, we are telling the software to use <code>demo.fq.gz</code> as input and to create a new output directory called <code>demo.humann2</code> where the results will be generated.</p>
<p>As the software runs, you might notice that as part of the process, <code>HUMAnN2</code> runs <code>MetaPhlAn2.</code> The purpose of this is to identify what species are present in the sample, so <code>HUMAnN2</code> can tailor generate an appropriate database of genes (from those species) to map against. It will carry out this alignment against the gene database, then a protein database, and finally compute which gene families are present to determine which functional pathways are present and how abundant they are.</p>
</div>
<div id="humann2-output" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> HUMAnN2: output</h3>
<p>Once the run has completed, change into the newly created output directory and list the files that are there.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb40-1"><a href="09-Functional_profiling.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> demo.humann2</span>
<span id="cb40-2"><a href="09-Functional_profiling.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span></span></code></pre></div>
<p>You will see that there are three files and one directory. The directory (<code>demo_humann2_temp</code>) contains intermediate temporary files and can be disregarded here.</p>
<p>The three output files are:</p>
<ul>
<li><code>demo_genefamilies.tsv</code>: A table file showing the number of reads mapping to each UniRef90 gene family, Values are normalised by the length of each gene family (i.e. RPK, or Reads per Kilobase). Additionally, the values are stratified so that they show the overall community abundance but also a breakdown of abundance per species detected. This allows researchers to delve into species specific functions, rather than only looking at the metagenomic functions as a whole,</li>
<li><code>demo_pathabundance.tsv</code>: As above, a table file showing the normalised abundance of MetaCyc pathways. These abundances are calculated based on the UniRef90 gene family mapping data and are also stratified by species.</li>
<li><code>demo_pathcoverage.tsv</code>: Similar to above, except instead of abundances of pathways, this table shows the coverage, or completeness, of pathways. For example, a pathway may contain 5 components (or genes/proteins)
<ul>
<li>Pathway1 : A → B → C → D → E 100% complete</li>
<li>A species identified in the sample may only have four of the components, though, meaning that the pathway is only 80% complete (represented as 0.8)</li>
<li>Pathway1 : A → B → C → <del>D</del> → E 80% complete</li>
</ul></li>
</ul>
<p>The basic format of these three output files is the same, so let’s take a look at the pathway abundance table.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="09-Functional_profiling.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> demo_pathabundance.tsv</span></code></pre></div>
<p>You will see that there are two columns:</p>
<ol style="list-style-type: decimal">
<li>The first column shows the pathways.
<ul>
<li><strong>UNMAPPED</strong> indicates reads that could not be aligned.</li>
<li><strong>UNINTEGRATED</strong> indicates reads that aligned to targets not implicated in any pathways.</li>
</ul></li>
<li>The second column shows the abundance.</li>
</ol>
<p>Press <code>q</code> to exit and let’s look at one specific pathway, COA-PWY-1 (a coenzyme A biosynthesis II pathway).</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="09-Functional_profiling.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span> COA-PWY-1 demo_pathabundance.tsv</span></code></pre></div>
<p>This shows two entries with two different values, I.e.</p>
<ul>
<li>COA-PWY-1: coenzyme A biosynthesis II (mammalian) 6.3694267516</li>
<li>COA-PWY-1: coenzyme A biosynthesis II (mammalian)|g__Bacteroides.s__Bacteroides_vulgatus 4.7961630695</li>
</ul>
<p>This is an example of the species stratification mentioned above. The first line shows the abundance of this pathway across the entire sample, but the second line shows the abundance contributed by <strong>Bacteroides_vulgatis</strong>.</p>
<p>Have a look at the other two output files; note the similar layout.</p>
<p>Finally, return to the parent directory i.e. <code>4-FunctionalProfiling</code></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="09-Functional_profiling.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span></code></pre></div>
<p><strong>Note</strong>: The directory <code>demo_humann2_temp</code> can be very large and so should be deleted in real projects once you are certain they are not needed. However, these files can be useful for debugging.</p>
</div>
</div>
<div id="statistical-comparison-between-samples" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Statistical comparison between samples</h2>
<p><img src="figures/k_w_venn.png" width="15%" style="display: block; margin: auto;" /></p>
<p>Looking at the functional profile of one sample in isolation is usually not very informative. First, there is nothing to compare it to and second, there are no biological replicates. We will therefore use all the Korean and Western diet samples.</p>
<p>It would take many hours to analyse all of the data using <code>HUMAnN2</code> and is outside of the scope of this course. For this reason, samples were analysed prior to the workshop to generate the output files we covered above.</p>
<p>For the purposes of this comparison, we will look at the pathway abundances only. First copy over the results data directory and have a look in it.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="09-Functional_profiling.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> –r /pub39/tea/matthew/NEOF/Shotgun_metagenomics/DietPathAbundance .</span>
<span id="cb44-2"><a href="09-Functional_profiling.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> DietPathAbundance</span></code></pre></div>
<p>You will see there are 12 files prefixed with K and 12 prefixed with W, for the Korean diet and Western diet samples, respectively. Take a look in one of the files; you might notice that there is no species stratification. The reason for this is that for this test, all pathway abundances have been collapsed to a community level, ignoring differences in species. When you analyse your own data-sets, you can leave this stratification in to identify significant differences between functional profiles at a species level.</p>
<p><strong>Note</strong>: You can create an unstratified pathabundance file with a command like: <code>cat pathabundance.tsv | grep -v "|" &gt; pathabundance.unstratified.tsv</code>. The <code>grep -v "|"</code> removes lines that contain <code>|</code> which the stratified lines should only contain.</p>
<div id="combining-data" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> Combining data</h3>
<p><img src="figures/merge.png" width="15%" style="display: block; margin: auto;" /></p>
<p>First, we need to combine these 24 tables into one large results table. <code>HUMAnN2</code> provides a tool to do this:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="09-Functional_profiling.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">humann2_join_tables</span> --input DietPathAbundance/ --output diet.tsv</span></code></pre></div>
<p>This command will look for all tables in the <code>DietPathAbundance</code> directory and generate a large, 24 column table called <code>diet.tsv</code>. You can take a look to see that this has worked correctly.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb46-1"><a href="09-Functional_profiling.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">less</span> -S diet.tsv</span></code></pre></div>
</div>
<div id="renormalising-data" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Renormalising data</h3>
<p><img src="figures/normalisation.png" width="15%" style="display: block; margin: auto;" /></p>
<p>The next step is to renormalise the data. Currently, all of the abundance values are only normalised within each sample, i.e. accounting for the size of the pathways/length of genes. However, they are not normalised between samples, and this is very important. For example, if we had sequenced two samples, A and B, and we obtained 5 million reads for sample A and 20 million reads for sample B, without normalisation, it might look that there was up to 4x as much functional activity in sample B!</p>
<p>To correct for this, we normalise the abundance values based on the number of reads in each sample. We will normalise by counts per million, or cpm. (We could also normalise to relative abundance where all abundances for each sample add up to 1).</p>
<p><strong>Equation:</strong>
<span class="math display">\[
cpm = p * (\frac{1000000}{t})
\]</span></p>
<p>Where:</p>
<ul>
<li><strong>cpm</strong> = counts per million.</li>
<li><strong>p</strong> = count of pathway in sample.</li>
<li><strong>t</strong> = total count of sample.</li>
</ul>
<p>Renormalisation command:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="09-Functional_profiling.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">humann2_renorm_table</span> <span class="kw">\</span></span>
<span id="cb47-2"><a href="09-Functional_profiling.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="ex">--units</span> cpm <span class="kw">\</span></span>
<span id="cb47-3"><a href="09-Functional_profiling.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="ex">--input</span> diet.tsv <span class="kw">\</span></span>
<span id="cb47-4"><a href="09-Functional_profiling.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="ex">--special</span> n <span class="kw">\</span></span>
<span id="cb47-5"><a href="09-Functional_profiling.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="ex">--output</span> diet.cpm.tsv</span></code></pre></div>
<p>This command generates the normalised data in the new table <code>diet.cpm.tsv</code>. The <code>--special n</code> option tells the script to remove all unmapped and unassigned values (<strong>UNMAPPED</strong> &amp; <strong>UNINTEGRATED</strong>) from the table.</p>
</div>
<div id="visualisation" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Visualisation</h3>
<p><img src="figures/Scatterplot.png" width="15%" style="display: block; margin: auto;" /></p>
<p>Now that we have our data normalised, we can visualise the dataset to see how the two groups look, i.e. do samples in the same diet group appear to correlate well with each other and are they distinguishable from those from the other diet group? To do this, we will draw a PCA plot. So that the plot will show which samples are from which group, we will need to provide the script with some metadata. This has been prepared and can be copied over as follows</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb48-1"><a href="09-Functional_profiling.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /pub39/tea/matthew/NEOF/Shotgun_metagenomics/diet.metadata.tsv .</span></code></pre></div>
<p>This is a table file where the first column is the sample name with subsequent columns representing categories of metadata. Here, the column of interest is the second one, ‘Diet,’ and samples are labelled as either ‘Western’ or ‘Korean.’ We can now run the PCA plot generation script and look at the result.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb49-1"><a href="09-Functional_profiling.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">PCA_plot.r</span> diet.cpm.tsv diet.metadata.tsv Diet diet.pca.pdf</span></code></pre></div>
<p>This command takes our data table as the first argument, our metadata table as the second argument, the metadata category of interest as the third argument and the output file as the final argument.</p>
<p><strong>Note</strong>: <code>PCA_plot.r</code> is a custom R script that will be provided after the course.</p>
<p>Now we can view the plot.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb50-1"><a href="09-Functional_profiling.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="ex">okular</span> diet.pca.pdf <span class="kw">&amp;</span></span></code></pre></div>
<p>You should see 3 plots, each one plotting 2 of the first 3 principal components against each other (see following image). The axis of each plot also shows how much of the overall variance that that particular component accounts for. Blue and red dots show the Western and Korean diet samples, respectively, and samples that cluster closely together are more similar to each other.</p>
<p>From this, we can see that there is some separation between the two dietary groups, but that they are not completely separated, i.e. there is some overlap. This can happen frequently with datasets such as this, that are likely to be much less controlled than laboratory samples and therefore show more between-group variance.</p>
<p><img src="figures/PCA1.png" width="60%" style="display: block; margin: auto;" /></p>
<p><strong>Questions</strong>: Is there anything unexpected about any of the samples, from these plots? If so, what might be a sensible course of action before proceeding with statistical analysis?</p>
</div>
<div id="finding-statistically-significant-differences" class="section level3" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Finding statistically significant differences</h3>
<p><img src="figures/lefse.png" width="15%" style="display: block; margin: auto;" /></p>
<p>For the final part of this section, we will see if there are any statistically significant differences between the two sample groups. There are several ways in which this can be achieved but we will carry out LEfSe again.</p>
<p>Go back to your LEfSe terminal (or create a new one and use <code>. uselefse</code>). Then change directory to <code>4-FunctionalProfiling</code>)</p>
<p>First make a new copy of the file we will work on:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb51-1"><a href="09-Functional_profiling.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> diet.cpm.tsv diet.cpm.lefse.tsv</span></code></pre></div>
<p>Change the file <code>diet.cpm.lefse.tsv</code> with you favourite text editor to make it LEfSe compatible. 2 edits are required:</p>
<ol style="list-style-type: decimal">
<li>Change the <code># Pathway</code> in the first line to <code>name</code>.</li>
<li>Add a new line at the top for the diet metadata (same as we did for the Bracken data)</li>
</ol>
<p>As you have carried out LEfSe already we will have one code box showing all the commands.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="09-Functional_profiling.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LEfSe format</span></span>
<span id="cb52-2"><a href="09-Functional_profiling.html#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="ex">lefse-format_input.py</span> diet.cpm.lefse.tsv diet.cpm.lefse -c 1 -u 2 -o 1000000</span>
<span id="cb52-3"><a href="09-Functional_profiling.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Run LEfSe</span></span>
<span id="cb52-4"><a href="09-Functional_profiling.html#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="ex">run_lefse.py</span> diet.cpm.lefse diet.cpm.lefse.out</span>
<span id="cb52-5"><a href="09-Functional_profiling.html#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Produce LEfSe plot</span></span>
<span id="cb52-6"><a href="09-Functional_profiling.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="ex">lefse-plot_res.py</span> --dpi 200 --format png diet.cpm.lefse.out biomarkers.png</span>
<span id="cb52-7"><a href="09-Functional_profiling.html#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="co">#View plot</span></span>
<span id="cb52-8"><a href="09-Functional_profiling.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="ex">okular</span> biomarkers.png</span></code></pre></div>
<p>Look at the output and see what pathways count as biomarkers for the 2 groups.</p>
<p>That completes the non assembly approach to shotgun metagenomic analysis. The next chapters will cover an assembly approach.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="08-Taxonomic_profiling.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="10-Metagenome_assembly.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
