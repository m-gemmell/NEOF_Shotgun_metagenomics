<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Taxonomic profiling | Shotgun Metagenomics</title>
  <meta name="description" content="NEOF book for the Microbial shotgun metagenomics workshop" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Taxonomic profiling | Shotgun Metagenomics" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/figures/NEOF.png" />
  <meta property="og:description" content="NEOF book for the Microbial shotgun metagenomics workshop" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Taxonomic profiling | Shotgun Metagenomics" />
  
  <meta name="twitter:description" content="NEOF book for the Microbial shotgun metagenomics workshop" />
  <meta name="twitter:image" content="/figures/NEOF.png" />

<meta name="author" content="Sam Haldenby and Matthew R. Gemmell" />


<meta name="date" content="2022-03-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="figures/NEOF_favicon.png" type="image/x-icon" />
<link rel="prev" href="07-Host_removal.html"/>
<link rel="next" href="09-Functional_profiling.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="https://neof.org.uk/" target="blank"><img src="figures/neof_small_logo.png"></a></li>
<li><a>Shotgun Metagenomics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="01-Shotgun_metagenomics.html"><a href="01-Shotgun_metagenomics.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="02-Overview.html"><a href="02-Overview.html"><i class="fa fa-check"></i><b>2</b> Overview</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-Overview.html"><a href="02-Overview.html#what-is-metagenomics"><i class="fa fa-check"></i><b>2.1</b> What is metagenomics?</a></li>
<li class="chapter" data-level="2.2" data-path="02-Overview.html"><a href="02-Overview.html#why-metagenomics"><i class="fa fa-check"></i><b>2.2</b> Why metagenomics?</a></li>
<li class="chapter" data-level="2.3" data-path="02-Overview.html"><a href="02-Overview.html#metagenomics-vs-metagenetics"><i class="fa fa-check"></i><b>2.3</b> Metagenomics vs Metagenetics</a></li>
<li class="chapter" data-level="2.4" data-path="02-Overview.html"><a href="02-Overview.html#tutorial-overview"><i class="fa fa-check"></i><b>2.4</b> Tutorial overview</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="02-Overview.html"><a href="02-Overview.html#basics"><i class="fa fa-check"></i><b>2.4.1</b> Basics</a></li>
<li class="chapter" data-level="2.4.2" data-path="02-Overview.html"><a href="02-Overview.html#structure"><i class="fa fa-check"></i><b>2.4.2</b> Structure</a></li>
<li class="chapter" data-level="2.4.3" data-path="02-Overview.html"><a href="02-Overview.html#content"><i class="fa fa-check"></i><b>2.4.3</b> Content</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-Start.html"><a href="03-Start.html"><i class="fa fa-check"></i><b>3</b> Before we start</a></li>
<li class="chapter" data-level="4" data-path="04-Cluster_Introduction.html"><a href="04-Cluster_Introduction.html"><i class="fa fa-check"></i><b>4</b> Cluster Introduction</a>
<ul>
<li class="chapter" data-level="4.1" data-path="04-Cluster_Introduction.html"><a href="04-Cluster_Introduction.html#logon-instructions"><i class="fa fa-check"></i><b>4.1</b> Logon instructions</a></li>
<li class="chapter" data-level="4.2" data-path="04-Cluster_Introduction.html"><a href="04-Cluster_Introduction.html#the-terminal-window"><i class="fa fa-check"></i><b>4.2</b> The Terminal Window</a></li>
</ul></li>
<li class="part"><span><b>Data &amp; QC</b></span></li>
<li class="chapter" data-level="5" data-path="05-Raw_data.html"><a href="05-Raw_data.html"><i class="fa fa-check"></i><b>5</b> Raw data</a>
<ul>
<li class="chapter" data-level="5.1" data-path="05-Raw_data.html"><a href="05-Raw_data.html#obtaining-the-data"><i class="fa fa-check"></i><b>5.1</b> Obtaining the data</a></li>
<li class="chapter" data-level="5.2" data-path="05-Raw_data.html"><a href="05-Raw_data.html#checking-quality-control"><i class="fa fa-check"></i><b>5.2</b> Checking quality control</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html"><i class="fa fa-check"></i><b>6</b> Quality control</a>
<ul>
<li class="chapter" data-level="6.1" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html#removing-adapters-and-low-quality-bases"><i class="fa fa-check"></i><b>6.1</b> Removing adapters and low quality bases</a></li>
<li class="chapter" data-level="6.2" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html#rename-the-files"><i class="fa fa-check"></i><b>6.2</b> Rename the files</a></li>
<li class="chapter" data-level="6.3" data-path="06-Trimming_data.html"><a href="06-Trimming_data.html#inspect-the-trimmed-data"><i class="fa fa-check"></i><b>6.3</b> Inspect the trimmed data</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="07-Host_removal.html"><a href="07-Host_removal.html"><i class="fa fa-check"></i><b>7</b> Host removal</a>
<ul>
<li class="chapter" data-level="7.1" data-path="07-Host_removal.html"><a href="07-Host_removal.html#index-reference"><i class="fa fa-check"></i><b>7.1</b> Index reference</a></li>
<li class="chapter" data-level="7.2" data-path="07-Host_removal.html"><a href="07-Host_removal.html#alignment"><i class="fa fa-check"></i><b>7.2</b> Alignment</a></li>
<li class="chapter" data-level="7.3" data-path="07-Host_removal.html"><a href="07-Host_removal.html#unmapped-read-extraction"><i class="fa fa-check"></i><b>7.3</b> Unmapped read extraction</a></li>
<li class="chapter" data-level="7.4" data-path="07-Host_removal.html"><a href="07-Host_removal.html#re-pair"><i class="fa fa-check"></i><b>7.4</b> Re-pair</a></li>
<li class="chapter" data-level="7.5" data-path="07-Host_removal.html"><a href="07-Host_removal.html#host-removal-considerations"><i class="fa fa-check"></i><b>7.5</b> Host removal considerations</a></li>
</ul></li>
<li class="part"><span><b>Read approach</b></span></li>
<li class="chapter" data-level="8" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html"><i class="fa fa-check"></i><b>8</b> Taxonomic profiling</a>
<ul>
<li class="chapter" data-level="8.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2"><i class="fa fa-check"></i><b>8.1</b> Kraken2</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2-run"><i class="fa fa-check"></i><b>8.1.1</b> Kraken2: run</a></li>
<li class="chapter" data-level="8.1.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2-output"><i class="fa fa-check"></i><b>8.1.2</b> Kraken2: output</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#krona-plot"><i class="fa fa-check"></i><b>8.2</b> Krona plot</a></li>
<li class="chapter" data-level="8.3" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken"><i class="fa fa-check"></i><b>8.3</b> Bracken</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-run"><i class="fa fa-check"></i><b>8.3.1</b> Bracken: run</a></li>
<li class="chapter" data-level="8.3.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-output"><i class="fa fa-check"></i><b>8.3.2</b> Bracken: output</a></li>
<li class="chapter" data-level="8.3.3" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-merging-output"><i class="fa fa-check"></i><b>8.3.3</b> Bracken: merging output</a></li>
<li class="chapter" data-level="8.3.4" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#bracken-extracting-output"><i class="fa fa-check"></i><b>8.3.4</b> Bracken: extracting output</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-biomarker-detection"><i class="fa fa-check"></i><b>8.4</b> LEfSe biomarker detection</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2_lefse_metadata"><i class="fa fa-check"></i><b>8.4.1</b> LEfSe: add metadata</a></li>
<li class="chapter" data-level="8.4.2" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-conda"><i class="fa fa-check"></i><b>8.4.2</b> LEfSe: conda</a></li>
<li class="chapter" data-level="8.4.3" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-format"><i class="fa fa-check"></i><b>8.4.3</b> LEfSe: format</a></li>
<li class="chapter" data-level="8.4.4" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-run"><i class="fa fa-check"></i><b>8.4.4</b> LEfSe: run</a></li>
<li class="chapter" data-level="8.4.5" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#lefse-visualisation"><i class="fa fa-check"></i><b>8.4.5</b> LEfSe: visualisation</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="08-Taxonomic_profiling.html"><a href="08-Taxonomic_profiling.html#kraken2-and-bracken-databases"><i class="fa fa-check"></i><b>8.5</b> Kraken2 and Bracken databases</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html"><i class="fa fa-check"></i><b>9</b> HUMAnN Functional profiling</a>
<ul>
<li class="chapter" data-level="9.1" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann"><i class="fa fa-check"></i><b>9.1</b> HUMAnN</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-conda-directories-and-files"><i class="fa fa-check"></i><b>9.1.1</b> HUMAnN: conda, directories, and files</a></li>
<li class="chapter" data-level="9.1.2" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-run"><i class="fa fa-check"></i><b>9.1.2</b> HUMAnN: run</a></li>
<li class="chapter" data-level="9.1.3" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-output"><i class="fa fa-check"></i><b>9.1.3</b> HUMAnN: output</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humannmultisampleprocessing"><i class="fa fa-check"></i><b>9.2</b> Multi sample processing</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-combining-data"><i class="fa fa-check"></i><b>9.2.1</b> HUMAnN: combining data</a></li>
<li class="chapter" data-level="9.2.2" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-split-stratified-table"><i class="fa fa-check"></i><b>9.2.2</b> HUMAnN: split stratified table</a></li>
<li class="chapter" data-level="9.2.3" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humannrenormalise"><i class="fa fa-check"></i><b>9.2.3</b> HUMAnN: renormalising data</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-heatmap"><i class="fa fa-check"></i><b>9.3</b> HUMAnN Heatmap</a></li>
<li class="chapter" data-level="9.4" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-lefse"><i class="fa fa-check"></i><b>9.4</b> HUMAnN: LEfSe</a></li>
<li class="chapter" data-level="9.5" data-path="09-Functional_profiling.html"><a href="09-Functional_profiling.html#humann-optional-task"><i class="fa fa-check"></i><b>9.5</b> HUMAnN: Optional task</a></li>
</ul></li>
<li class="part"><span><b>Assembly Approach</b></span></li>
<li class="chapter" data-level="10" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html"><i class="fa fa-check"></i><b>10</b> Metagenome assembly</a>
<ul>
<li class="chapter" data-level="10.1" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#metagenome-assembly-conda"><i class="fa fa-check"></i><b>10.1</b> Metagenome assembly: Conda</a></li>
<li class="chapter" data-level="10.2" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#a-primer-on-short-read-assembly"><i class="fa fa-check"></i><b>10.2</b> A primer on short read assembly</a></li>
<li class="chapter" data-level="10.3" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#stitching-read-pairs"><i class="fa fa-check"></i><b>10.3</b> Stitching read pairs</a></li>
<li class="chapter" data-level="10.4" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#assembly"><i class="fa fa-check"></i><b>10.4</b> Assembly</a></li>
<li class="chapter" data-level="10.5" data-path="10-Metagenome_assembly.html"><a href="10-Metagenome_assembly.html#quast"><i class="fa fa-check"></i><b>10.5</b> QUAST</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html"><i class="fa fa-check"></i><b>11</b> Genome binning</a>
<ul>
<li class="chapter" data-level="11.1" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#metabat2"><i class="fa fa-check"></i><b>11.1</b> MetaBAT2</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#metabat2-conda-environment-directory"><i class="fa fa-check"></i><b>11.1.1</b> MetaBAT2: Conda environment &amp; directory</a></li>
<li class="chapter" data-level="11.1.2" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#metabat2-depth-calculation"><i class="fa fa-check"></i><b>11.1.2</b> MetaBAT2: depth calculation</a></li>
<li class="chapter" data-level="11.1.3" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#metabat2-run"><i class="fa fa-check"></i><b>11.1.3</b> MetaBAT2: run</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#checkm"><i class="fa fa-check"></i><b>11.2</b> CheckM</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#checkm-conda"><i class="fa fa-check"></i><b>11.2.1</b> CheckM: Conda</a></li>
<li class="chapter" data-level="11.2.2" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#checkm-run"><i class="fa fa-check"></i><b>11.2.2</b> CheckM: run</a></li>
<li class="chapter" data-level="11.2.3" data-path="11-Genome_binning.html"><a href="11-Genome_binning.html#checkm-output"><i class="fa fa-check"></i><b>11.2.3</b> CheckM: output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html"><i class="fa fa-check"></i><b>12</b> Assembly functional annotation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#taxonomic-annotation"><i class="fa fa-check"></i><b>12.1</b> Taxonomic annotation</a></li>
<li class="chapter" data-level="12.2" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#prokka"><i class="fa fa-check"></i><b>12.2</b> Prokka</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#prokka_conda"><i class="fa fa-check"></i><b>12.2.1</b> Prokka: conda and directories</a></li>
<li class="chapter" data-level="12.2.2" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#prokka-run"><i class="fa fa-check"></i><b>12.2.2</b> Prokka: run</a></li>
<li class="chapter" data-level="12.2.3" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#prokka-output"><i class="fa fa-check"></i><b>12.2.3</b> Prokka: output</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#minpath"><i class="fa fa-check"></i><b>12.3</b> MinPath</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#minpath-conda-and-directory"><i class="fa fa-check"></i><b>12.3.1</b> MinPath: conda and directory</a></li>
<li class="chapter" data-level="12.3.2" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#minpath-ec-extraction"><i class="fa fa-check"></i><b>12.3.2</b> MinPath: EC extraction</a></li>
<li class="chapter" data-level="12.3.3" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#minpath-run"><i class="fa fa-check"></i><b>12.3.3</b> MinPath: run</a></li>
<li class="chapter" data-level="12.3.4" data-path="12-Assembly_functional_annotation.html"><a href="12-Assembly_functional_annotation.html#minpath-output"><i class="fa fa-check"></i><b>12.3.4</b> MinPath: output</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="13-Appendix.html"><a href="13-Appendix.html"><i class="fa fa-check"></i><b>A</b> Next steps</a></li>
<li class="chapter" data-level="B" data-path="13-Appendix.html"><a href="13-Appendix.html#manuals"><i class="fa fa-check"></i><b>B</b> Manuals</a></li>
<li class="chapter" data-level="C" data-path="13-Appendix.html"><a href="13-Appendix.html#obtaining-read-data"><i class="fa fa-check"></i><b>C</b> Obtaining Read Data</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Shotgun Metagenomics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="taxprofile" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Taxonomic profiling</h1>
<p><img src="figures/classification.png" width="30%" style="display: block; margin: auto;" /></p>
<p>There are a number of methods for determining the species composition of a metagenomic data-set, but for the purposes of this practical we will use <code>Kraken2</code> &amp; <code>Bracken</code> (Bayesian Reestimation of Abundance with KrakEN). <code>Kraken2</code> classifies short DNA with taxonomic labels and is frequently used for metagenomic studies. <code>Bracken</code> uses the taxonomic labels assigned by <code>Kraken2</code> to compute the abundance of species in a set of DNA sequences.</p>
<p>First, we’ll make a new directory for it and move into it, after returning home:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="08-Taxonomic_profiling.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ..</span>
<span id="cb20-2"><a href="08-Taxonomic_profiling.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> 3-Taxonomy</span>
<span id="cb20-3"><a href="08-Taxonomic_profiling.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> 3-Taxonomy</span></code></pre></div>
<div id="kraken2" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Kraken2</h2>
<p><img src="figures/kraken.png" width="15%" style="display: block; margin: auto;" /></p>
<p>Prior to running <code>Kraken2</code> we need to set a variable so <code>Kraken2</code> knows where to look for the databases it will use.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="08-Taxonomic_profiling.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">KRAKEN2_DB_PATH</span><span class="op">=</span>/pub39/tea/matthew/NEOF/Shotgun_metagenomics/kraken2_db</span></code></pre></div>
<p><strong>Note</strong>: You can look at the contents of the above directory to see it currently contains the MiniKraken database. This database contains only a subset of the bacteria, archaea, and viral <code>Kraken2</code> libraries. This is used in this practical due to restrictions on time and computational resources. For your own analyses we would recommend the full <code>Kraken2</code> database which uses all the bacteria, achaeal and viral complete genomes that are in Refseq at the time of building. See the appendix for a link to the <code>Kraken2</code> manual.</p>
<div id="kraken2-run" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> Kraken2: run</h3>
<p><img src="figures/enter_key.png" width="10%" style="display: block; margin: auto;" /></p>
<p>Now, run <code>Kraken2</code> on sample K1 by running the following command.</p>
<p><strong>Note</strong>: As there is little human sequence in our data we will not use host removed data.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="08-Taxonomic_profiling.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">kraken2</span> <span class="at">--paired</span> <span class="at">--db</span> minikraken2_v1_8GB <span class="dt">\</span></span>
<span id="cb22-2"><a href="08-Taxonomic_profiling.html#cb22-2" aria-hidden="true" tabindex="-1"></a>--output K1.kraken <span class="at">--report</span> K1.kreport2 <span class="dt">\</span></span>
<span id="cb22-3"><a href="08-Taxonomic_profiling.html#cb22-3" aria-hidden="true" tabindex="-1"></a>~/2-Trimmed/K1_R1.fq.gz ~/2-Trimmed/K1_R2.fq.gz</span></code></pre></div>
<p>While this is running, let’s look at what those command line options do:</p>
<ul>
<li><code>~/2-Trimmed/K1_R1.fq.gz ~/2-Trimmed/K1_R2.fq.gz</code> : the trimmed read pairs for K1, which we will use as input.</li>
<li><code>--paired</code> : Indicates that we are providing paired reads to <code>Kraken2</code>. Internally, <code>Kraken2</code> will concatenate the R1 and R2 reads into one sequence with an N between them.</li>
<li><code>--db</code> : Specify the <code>Kraken2</code> database to be used for taxonomic classification. Previous to the command we set the <code>KRAKEN_DB_PATH</code> so in this case the command will look for the directory called <code>minikraken2_v1_8GB</code> within <code>KRAKEN_DB_PATH</code>. Alternatively the full path of the required database could be provided.</li>
<li><code>--threads</code> : How many CPUs the process will use.</li>
<li><code>--output</code> : This is the output file.</li>
</ul>
</div>
<div id="kraken2-output" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Kraken2: output</h3>
<p><img src="figures/output.png" width="10%" style="display: block; margin: auto;" /></p>
<p>There are two major output formats from Kraken2:</p>
<ul>
<li><code>--output</code>, <code>.kraken</code>: Each sequence (or sequence pair, in the case of paired reads) classified by <code>Kraken2</code> results in a single line of output. <code>Kraken2</code>’s output lines contain five tab-delimited fields; from left to right, they are:
<ol style="list-style-type: decimal">
<li>“C”/“U”: a one letter code indicating that the sequence was either classified or unclassified.</li>
<li>The sequence ID, obtained from the FASTA/FASTQ header.</li>
<li>The taxonomy ID <code>Kraken2</code> used to label the sequence; this is 0 if the sequence is unclassified.</li>
<li>The length of the sequence in bp. In the case of paired read data, this will be a string containing the lengths of the two sequences in bp, separated by a pipe character, e.g. “98|94”.</li>
<li>A space-delimited list indicating the LCA mapping of each k-mer in the sequence(s). For example, “562:13 561:4 A:31 0:1 562:3” would indicate that:
<ul>
<li>the first 13 k-mers mapped to taxonomy ID #562</li>
<li>the next 4 k-mers mapped to taxonomy ID #561</li>
<li>the next 31 k-mers contained an ambiguous nucleotide</li>
<li>the next k-mer was not in the database</li>
<li>the last 3 k-mers mapped to taxonomy ID #562</li>
<li><strong>Note</strong>: that paired read data will contain a “|:|” token in this list to indicate the end of one read and the beginning of another.</li>
</ul></li>
</ol></li>
<li><code>--report</code>, <code>.kreport2</code>: The report output format. This is required for bracken. It is tab-delimited with one line per taxon. The fields of the output, from left-to-right, are as follows:
<ol style="list-style-type: decimal">
<li>Percentage of fragments covered by the clade rooted at this taxon.</li>
<li>Number of fragments covered by the clade rooted at this taxon.</li>
<li>Number of fragments assigned directly to this taxon.</li>
<li>A rank code, indicating (U)nclassified, (R)oot, (D)omain, (K)ingdom, (P)hylum, (C)lass, (O)rder, (F)amily, (G)enus, or (S)pecies. Taxa that are not at any of these 10 ranks have a rank code that is formed by using the rank code of the closest ancestor rank with a number indicating the distance from that rank. E.g., “G2” is a rank code indicating a taxon is between genus and species and the grandparent taxon is at the genus rank.</li>
<li>NCBI taxonomic ID number</li>
<li>Indented scientific name</li>
</ol></li>
</ul>
<p>The output to screen will show how many sequences are classified. This will be lower than normal as we are using a mini <code>Kraken2</code> database.</p>
<p>In a real analysis you may use the option <code>--confidence</code> which represents the <strong>“Confidence score threshold”</strong>. The default is <code>0.0</code>, which is the lowest, with the maximum value being <code>1</code>. A good place to start may be <code>0.1</code>. Too many classifications are removed if you attempt it with this dataset, due to the mini <code>Kraken2</code> database used. More info on the confidence scoring can be found at: <a href="https://github.com/DerrickWood/kraken2/wiki/Manual#confidence-scoring" class="uri">https://github.com/DerrickWood/kraken2/wiki/Manual#confidence-scoring</a></p>
<p><strong>Task</strong>: Once the Kraken2 command has finished running, run it on the other two samples.</p>
<p><strong>Hint</strong>: You will need to change all instances of K1 to K2 or W1 in the above command</p>
</div>
</div>
<div id="krona-plot" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Krona plot</h2>
<p><img src="figures/krona.png" width="15%" style="display: block; margin: auto;" /></p>
<p><code>Krona</code> is an interactive metagenome species abundance visualisation tool.</p>
<p>We can use the <code>Kraken2</code> report files to create our Krona plots. With the below command we can import our <code>Kraken2</code> taxonomy (within the report file) into a <code>Krona</code> html.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="08-Taxonomic_profiling.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ktImportTaxonomy</span> <span class="at">-o</span> kraken2.krona.html <span class="pp">*</span>.kreport2</span></code></pre></div>
<p><code>-o</code> is our output html file, and the final argument <code>*.kreport2</code> represents all of our <code>.kreport2</code> files in the current directory. The <code>*</code> is a wild-card, meaning any characters any number of times. Therefore <code>*.kreport2</code> identifies the files <code>K1.kreport2</code> <code>K2.kreport2</code> and <code>W1.kreport2</code>.</p>
<p>You will get a warning that not all taxonomy IDs were found. We will ignore this but in your own future installations this should be addressed with <code>Krona</code>’s <code>updateTaxonomy.sh</code> command.</p>
<p>Now we can view our interactive chart in a web browser.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="08-Taxonomic_profiling.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">firefox</span> kraken2.krona.html <span class="kw">&amp;</span></span></code></pre></div>
<p><strong>Question</strong>: Can you tell which sample looks the most different in terms of bacterial species that are present and absent?</p>
</div>
<div id="bracken" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Bracken</h2>
<p><img src="figures/bracken.png" width="15%" style="display: block; margin: auto;" /></p>
<p><code>Bracken</code> (Bayesian Reestimation of Abundance with KrakEN) uses taxonomy labels assigned by <code>Kraken2</code> to compute estimated abundances of species in a metagenomic sample.</p>
<div id="bracken-run" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Bracken: run</h3>
<p><img src="figures/enter_key.png" width="10%" style="display: block; margin: auto;" /></p>
<p>Just like with <code>Krona</code> we can use the <code>Kraken2</code> report files to run bracken.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb25-1"><a href="08-Taxonomic_profiling.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="ex">bracken</span> <span class="at">-d</span> <span class="va">$KRAKEN2_DB_PATH</span>/minikraken2_v1_8GB <span class="dt">\</span></span>
<span id="cb25-2"><a href="08-Taxonomic_profiling.html#cb25-2" aria-hidden="true" tabindex="-1"></a>-i K1.kreport2 <span class="at">-o</span> K1.bracken <span class="at">-r</span> 100 <span class="at">-l</span> S <span class="at">-t</span> 5</span></code></pre></div>
<p>Let’s look at what those command line options do:</p>
<ul>
<li><code>-d</code> : Specifies the <code>Kraken2</code> database that was used for taxonomic classification. In this case bracken requires the variable <code>$KRAKEN_DB_PATH</code> so the option is provided the full path to the kraken database. For clarity try the command <code>ls $KRAKEN2_DB_PATH/minikraken2_v1_8GB</code>.</li>
<li><code>-i</code> : The <code>Kraken2</code> report file, this will be used as the input.</li>
<li><code>-o</code> : The output <code>Bracken</code> file. Information about its contents is below.</li>
<li><code>-r 100</code>: This is the ideal length of the reads that were used in the <code>Kraken2</code> classification. It is recommended that the initial read length of the sequencing data is used. We are using 100 here as we used a paired library of 100 bp reads.</li>
<li><code>-l S</code>: This specifies the taxonomic level/rank of the <code>Bracken</code> output. In this case <code>S</code> is equal to species with the other options being <code>D</code>, <code>P</code>, <code>C</code>, <code>O</code>,<code>F</code> and <code>G</code>.</li>
<li><code>-t 5</code>: This specifies the minimum number of reads required for a classification at the specified rank. Any classifications with fewer reads than the specified threshold will not receive additional reads from higher taxonomy levels when distributing reads for abundance estimation. Five has been chosen here for this example data but in real datasets you may want to increase this number (default is 10).</li>
</ul>
</div>
<div id="bracken-output" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Bracken: output</h3>
<p><img src="figures/output.png" width="10%" style="display: block; margin: auto;" /></p>
<p>The output file of <code>Bracken</code> contains the following columns:</p>
<ol style="list-style-type: decimal">
<li><strong>Name</strong>: Name of taxonomy at the specified taxonomic level.</li>
<li><strong>Taxonomy ID</strong>: NCBI taxonomy id</li>
<li><strong>Level ID</strong>: Letter signifying the taxonomic level of the classification</li>
<li><strong>Kraken assigned read</strong>: Number of reads assigned to the taxonomy by <code>Kraken2</code>.</li>
<li><strong>Added reads with abundance reestimation</strong>: Number of reads added to the taxonomy by Bracken abundance reestimation.</li>
<li><strong>Total reads after abundance reestimation</strong>: Number from field 4 and 5 summed. This is the field that will be used for downstream analysis.</li>
<li><strong>Fraction of total reads</strong>: Relative abundance of the taxonomy.</li>
</ol>
<p>Use <code>less</code> or <code>vim</code> to look at the bracken output.</p>
<p><strong>Task</strong>: Repeat the above commands for K2 and W1</p>
</div>
<div id="bracken-merging-output" class="section level3" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Bracken: merging output</h3>
<p><img src="figures/merge.png" width="10%" style="display: block; margin: auto;" /></p>
<p>To make full use of <code>Bracken</code> output, it is best to merge the output into one table. However before we do this we’ll copy the <code>Bracken</code> output of other samples that have been generated prior to the workshop. These are all either Korean or Western Diet samples.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="08-Taxonomic_profiling.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> /pub39/tea/matthew/NEOF/Shotgun_metagenomics/bracken/<span class="pp">*</span> .</span></code></pre></div>
<p>Now to merge all the K and W <code>Bracken</code> files.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="08-Taxonomic_profiling.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">combine_bracken_outputs.py</span> <span class="at">--files</span> [KW]<span class="pp">*</span>.bracken <span class="at">-o</span> all.bracken</span></code></pre></div>
<p>This output file contains the first three columns:</p>
<ul>
<li><strong>name</strong> = Organism group name. This will be based on the TAX_LVL chosen in the <code>Bracken</code> command and will only show the one level.</li>
<li><strong>taxonomy_id</strong> = Taxonomy id number.</li>
<li><strong>taxonomy_lvl</strong> = A single string indicating the taxonomy level of the group. (‘D’,‘P’,‘C’,‘O’,‘F’,‘G’,‘S’).</li>
</ul>
<p>Following these columns are the following two columns for each sample.</p>
<ul>
<li><code>${SampleName}.bracken_num</code>: The number of reads after abundance reestimation</li>
<li><code>${SampleName}.bracken_frac</code>: Relative abundance of the group in the sample</li>
</ul>
</div>
<div id="bracken-extracting-output" class="section level3" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Bracken: extracting output</h3>
<p><img src="figures/exctractor.png" width="10%" style="display: block; margin: auto;" /></p>
<p>We want a file with only the first column (organism name) and the <code>bracken_num</code> columns for each sample. To carry this out we first create a sequence of numbers that will match the <code>bracken_num</code> column numbers. These start at column 4 and are every even numbered column after this. We will use <code>seq</code> to create every <code>2</code> numbers from the numbers <code>4</code> to <code>50</code> with commas (<code>,</code>) as separators (<code>-s</code>).</p>
<p><strong>Note</strong>: The number 50 is chosen as 3 (first three info columns) + 24*2 (24 samples with 2 columns each) = 50.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="08-Taxonomic_profiling.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Try out the seq command to see its output</span></span>
<span id="cb28-2"><a href="08-Taxonomic_profiling.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span> <span class="at">-s</span> , 4 2 50</span>
<span id="cb28-3"><a href="08-Taxonomic_profiling.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Create variable</span></span>
<span id="cb28-4"><a href="08-Taxonomic_profiling.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="va">bracken_num_columns</span><span class="op">=</span><span class="va">$(</span><span class="fu">seq</span> <span class="at">-s</span> , 4 2 50<span class="va">)</span></span>
<span id="cb28-5"><a href="08-Taxonomic_profiling.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="va">$bracken_num_columns</span></span></code></pre></div>
<p>Now to use the variable to extract the <code>bracken_num</code> columns plus the first column (species names).</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="08-Taxonomic_profiling.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> all.bracken <span class="kw">|</span> <span class="fu">cut</span> <span class="at">-f</span> 1,<span class="va">$bracken_num_columns</span> <span class="op">&gt;</span> all_num.bracken</span></code></pre></div>
</div>
</div>
<div id="lefse-biomarker-detection" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> LEfSe biomarker detection</h2>
<p><img src="figures/lefse.png" width="15%" style="display: block; margin: auto;" /></p>
<p>We will use <code>LEfSe</code> (Linear discriminant analysis Effect Size) to determine which taxa can most likely explain the differences between the Western and Korean diet. <code>LEfSe</code> couples standard tests for statistical significance with additional tests encoding biological consistency and effect relevance. It can be used with other features such as organisms, clades, operational taxonomic units, genes, or functions.</p>
<p>In essence it allows for the detection of biomarkers when comparing sample groups. In the <code>LEfSe</code> terminology the sample groups are called the class.</p>
<div id="kraken2_lefse_metadata" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> LEfSe: add metadata</h3>
<p><img src="figures/header.png" width="10%" style="display: block; margin: auto;" /></p>
<p>We need to add metadata to our <code>Bracken</code> file to be ready for <code>LEfSe.</code> First we will copy the file so we have a backup in case we do anything wrong.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="08-Taxonomic_profiling.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> all_num.bracken all_num.lefse.bracken</span></code></pre></div>
<p>Using your favourite text editor (e.g. <code>nano</code>, <code>vim</code>, etc.) add the following line to the top of your <code>all_num.lefse.bracken</code> file. The words are separated by tabs. If you are not sure how to carry out this task please ask a demonstrator.</p>
<p><strong>diet K K K K K K K K K K K K W W W W W W W W W W W W</strong></p>
<p><strong>Note</strong>: The above is <strong>diet</strong> followed by 12 <strong>K</strong> and 12 <strong>W</strong>.</p>
<p>The singular line should match the order of your samples within the file. This is the metadata line that <code>LEfSe</code> will use to determine which samples belong to each sample group, and therefore which to compare. In this case it is Korean diet samples versus Western diet samples.</p>
</div>
<div id="lefse-conda" class="section level3" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> LEfSe: conda</h3>
<p><img src="figures/conda.png" width="10%" style="display: block; margin: auto;" /></p>
<p><code>LEfSe</code> requires python2 whilst we have been using packages that required python3. We therefore need to use a different <code>conda</code> environment. We are currently using the <code>conda</code> env called <code>shotgun_meta</code> as represented by <code>(shotgun_meta)</code>. This was activated with the command <code>. useshotgun</code>.</p>
<p>Open a new terminal (right click on the main screen background, choose <code>Applications</code> -&gt; <code>Shell</code> -&gt; <code>bash</code>) and run the following in the new terminal to activate the <code>lefse</code> <code>conda</code> environment.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="08-Taxonomic_profiling.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setup environment</span></span>
<span id="cb31-2"><a href="08-Taxonomic_profiling.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="bu">.</span> uselefse</span>
<span id="cb31-3"><a href="08-Taxonomic_profiling.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Change directory</span></span>
<span id="cb31-4"><a href="08-Taxonomic_profiling.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/3-Taxonomy</span></code></pre></div>
</div>
<div id="lefse-format" class="section level3" number="8.4.3">
<h3><span class="header-section-number">8.4.3</span> LEfSe: format</h3>
<p><img src="figures/lefse_format.png" width="10%" style="display: block; margin: auto;" /></p>
<p>We need to further format and preprocess our file with a <code>LEfSe</code> script.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="08-Taxonomic_profiling.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">lefse-format_input.py</span> all_num.lefse.bracken all_num.lefse <span class="at">-c</span> 1 <span class="at">-u</span> 2 <span class="at">-o</span> 1000000</span></code></pre></div>
<ul>
<li><code>all_num.lefse.bracken</code> : Input <code>Bracken</code> file.</li>
<li><code>all_num.lefse</code> : Output file formatted for the run_lefse command, which we will soon run.</li>
<li><code>-c 1</code> : Specifies the row with the class info. This is used to determine which samples will be compared against which samples. In this case it is the first row with the Ks and Ws.</li>
<li><code>-u 2</code> : Specifies the row with the sample names. This is the second row in this case.</li>
<li><code>-o 1000000</code> : An integer can be indicated to determine to what size (count sum value) each sample should be normalised to. <code>LEfSe</code> developers recommend 1000000 (1 million) when very low values a present. We generally always use 1 million for consistency.</li>
</ul>
</div>
<div id="lefse-run" class="section level3" number="8.4.4">
<h3><span class="header-section-number">8.4.4</span> LEfSe: run</h3>
<p><img src="figures/enter_key.png" width="10%" style="display: block; margin: auto;" /></p>
<p>Now to run <code>LEfSe.</code> All we need to do is run the command with the formatted input and provide an output file name.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="08-Taxonomic_profiling.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">run_lefse.py</span> all_num.lefse all_num.lefse.out</span></code></pre></div>
<p>The output file is a tab-delimited file which contains a row for each species. Biomarkers will have the five columns below whilst non-biomarkers will have the first two followed by a “-” .</p>
<ul>
<li><strong>Biomarker name</strong></li>
<li><strong>Log of highest class average</strong>: I.e. get the class with the greater amounts of the biomarker, average the counts and then get the log of this value.</li>
<li><strong>Class with the greater amounts of biomarker</strong></li>
<li><strong>LDA effect size</strong>: A statistical figure for <code>LEfSe</code>..</li>
<li>p-value: Biomarkers must have a p-value of &lt;0.05 to be considered significant.</li>
</ul>
<p>The <strong>LDA effect</strong> size indicates how much of an effect each biomarker has. The default is to only count a species with an LDA effect size of greater than 2 or less than -2 as a biomarker. The further the LDA effect size is from 0 the greater the effect the species causes.</p>
</div>
<div id="lefse-visualisation" class="section level3" number="8.4.5">
<h3><span class="header-section-number">8.4.5</span> LEfSe: visualisation</h3>
<p><img src="figures/bar_chart_horizontal.png" width="10%" style="display: block; margin: auto;" /></p>
<p>Next we can visualise the output.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="08-Taxonomic_profiling.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">lefse-plot_res.py</span> <span class="at">--dpi</span> 200 <span class="at">--format</span> png all_num.lefse.out biomarkers.png</span></code></pre></div>
<ul>
<li><code>--dpi 200</code> : Dots per inch. This refers to the resolution of the output image. Normally publications want 300 dpi. We’ve chosen 200 as it is good quality and we will not be publishing these results.</li>
<li><code>--format png</code> : Format of output file. png is a commonly used file format for images.</li>
<li><code>all_num.lefse.out</code> : <code>LEfSe</code> output to visualise.</li>
<li><code>biomarkers.png</code> : Plot showing the LDA scores of the species detected as biomarkers. Colouring shows which class (K or W) the species is found in higher abundance.</li>
</ul>
<p>Look at the figure with the program <code>okular</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="08-Taxonomic_profiling.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">okular</span> biomarkers.png</span></code></pre></div>
<p><strong>Questions</strong>:</p>
<ul>
<li>Which species causes the biggest effect in the W class and in the K class?</li>
<li>Which class has more biomarkers associated with it?</li>
</ul>
<p><strong>Note</strong>: In this instance green bars represent biomarkers in higher abundance in the W samples whilst the red bars represent biomarkers in higher abundance in the K samples.</p>
</div>
</div>
<div id="kraken2-and-bracken-databases" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Kraken2 and Bracken databases</h2>
<p><img src="figures/database.png" width="15%" style="display: block; margin: auto;" /></p>
<p>In your own future analysis you will need to create your own <code>Kraken2</code> and <code>Bracken</code> databases. Please sse the following links on information for this:</p>
<ul>
<li><code>Kraken2</code>
<ul>
<li>Standard <code>Kraken2</code> databases: <a href="https://github.com/DerrickWood/kraken2/wiki/Manual#standard-kraken-2-database" class="uri">https://github.com/DerrickWood/kraken2/wiki/Manual#standard-kraken-2-database</a></li>
<li>Custom <code>Kraken2</code> databases: <a href="https://github.com/DerrickWood/kraken2/wiki/Manual#custom-databases" class="uri">https://github.com/DerrickWood/kraken2/wiki/Manual#custom-databases</a></li>
</ul></li>
<li><code>Bracken</code>
<ul>
<li><a href="https://ccb.jhu.edu/software/bracken/index.shtml?t=manual#step1" class="uri">https://ccb.jhu.edu/software/bracken/index.shtml?t=manual#step1</a></li>
<li>This requires a <code>Kraken2</code> database to be built first.</li>
</ul></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="07-Host_removal.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="09-Functional_profiling.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
